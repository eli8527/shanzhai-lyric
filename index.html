<head>
<style>
  body, html, p {
    margin: 0;
    padding: 0;
  }
  .container {
    width: 100vw;
    height: 100vh;
    position: relative;
  }
  img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .fixed {
    position: fixed;
    left: 0;
    top: 0;
    z-index: 1;
  }

  .text-wrapper {
    font-family: sans-serif;
    font-size: 48px;
    position: fixed;
    bottom: 40px;
    width: calc(100% - 40px * 2);
    left: 40px;
  }

  .background--light {
    color: #000;
  }
  .background--dark {
    color: #fff;
  }

</style>
</head>
<body>
  <div class="container fixed">
    <div class="text-wrapper">
      <p class="text" id="entry-text"></p>
    </div>
  </div>
  <div class="container entry" data-text="everything is runimed / we're domed / nothing can save us / we're all going to die">
    <img class="background-img" src="image1.jpg">
  </div>
  <div class="container entry" data-text="e.seven costumes, / eadig the forefront of Engtand. / and always give you a fresn / exoedence,continuous innovation is / the purpose of e.seven clothing">
    <img class="background-img" src="image2.jpg">
  </div>
  <script src="background-check.js"></script>
  <script>
    window.onload = () => {
      let backgroundCheck = () => {
        BackgroundCheck.init({
          targets: '.text-frag',
          images: '.background-img',
          threshold: 55,
        });
      }

      let processText = () => {
        let texts = document.getElementsByClassName('text');
        [].forEach.call(texts, (text) => {
          let innerHTML = text.innerHTML;
          let chars = innerHTML.split('');

          let newInner = '';
          chars.forEach((char) => {
            newInner += `<span class="text-frag">${char}</span>`;
          })

          text.innerHTML = newInner;
        });
      }

      let initScroll = () => {
       window.addEventListener('scroll', () => {
         // const scrollPos = document.documentElement.scrollTop || document.body.scrollTop;

         let entries = document.getElementsByClassName('entry');
         [].forEach.call(entries, (entry) => {
           let top = entry.getBoundingClientRect().top;
           if (top < window.innerHeight/2 && top > -window.innerHeight/2) {
             let newEntryText = entry.dataset.text;
             if (entryText !== newEntryText) {
               entryText = newEntryText;
               entryTextElement.innerHTML = entryText;
               processText();
               backgroundCheck();
             }
           }
         });
       });
      }

      let entryText = document.getElementsByClassName('entry')[0].dataset.text;
      let entryTextElement = document.getElementById('entry-text');

      entryTextElement.innerHTML = entryText;

      processText();
      initScroll();
      backgroundCheck();
    }
  </script>
</body>
